# Netlify 配置文件
# 确保 Service Worker 和 PWA 功能正常工作
# 注意：此项目同时支持 Netlify 和 GitHub Pages 部署
# GitHub Pages 需要 .nojekyll 文件（已创建）来确保 Service Worker 正常工作

[build]
  # 如果使用构建命令，在这里配置
  # command = "npm run build"
  # publish = "dist"

# 重定向规则
[[redirects]]
  from = "/sw.js"
  to = "/sw.js"
  status = 200
  force = true
  headers = {X-Content-Type-Options = "nosniff", X-Frame-Options = "DENY"}

# 安全头设置
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "notifications=*, geolocation=*"
    # CORS支持 - 允许字体和资源跨域加载
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"
    Access-Control-Allow-Headers = "Content-Type, Authorization"

# 字体文件CORS支持
[[headers]]
  for = "/*.ttf"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, OPTIONS"
    Content-Type = "font/ttf"

[[headers]]
  for = "/*.woff"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, OPTIONS"
    Content-Type = "font/woff"

[[headers]]
  for = "/*.woff2"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, OPTIONS"
    Content-Type = "font/woff2"

[[headers]]
  for = "/*.otf"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, OPTIONS"
    Content-Type = "font/otf"

# CSS文件CORS支持
[[headers]]
  for = "/*.css"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, OPTIONS"
    Content-Type = "text/css"

# Service Worker 特殊配置
[[headers]]
  for = "/sw.js"
  [headers.values]
    Content-Type = "application/javascript; charset=utf-8"
    Service-Worker-Allowed = "/"
    Cache-Control = "no-cache, no-store, must-revalidate"

# Manifest 文件配置
[[headers]]
  for = "/manifest.json"
  [headers.values]
    Content-Type = "application/manifest+json"
    Cache-Control = "public, max-age=3600"

